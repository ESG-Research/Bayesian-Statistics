---
title: "Q3"
author: "Zhaojie"
date: "8/26/2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
#Question Practice
library(readr)
pctgrowth <- read_csv("C:/Users/33219/Desktop/pctgrowth.csv")
View(pctgrowth)
any(is.na(pctgrowth))
dat = na.omit(pctgrowth)

```

```{r}
boxplot(dat$y~dat$grp)
```

```{r}
library("rjags")

mod_string = "model {
 for (i in 1:length(y)) {
   y[i] ~ dnorm(mu[grp[i]] ,prec) 
   }
 for (j in 1:max(grp)) {
  mu[j] ~ dnorm(mg ,trec) 
 }
   
   mg ~ dnorm(0,1e6)
   
   trec ~ dgamma(1/2,1*3/2)
   tao2=1/trec
   tao=sqrt(tao2)
   
   prec ~ dgamma(2/2, 2*1/2) #这里用gamma下面还要换成inverse
   sig2= 1/prec #注意这里其实sig2是inverse gamma
   sig = sqrt(sig2)
 }"

set.seed(102)

data_jags = as.list(dat)

params = c("mu", "sig", "mg", "tao")

mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1e3)

mod_sim = coda.samples(model=mod,
                        variable.names=params,
                        n.iter=5e3)
mod_csim = as.mcmc(do.call(rbind, mod_sim))

plot(density(mod_csim[,"mu[1]"]))
summary(mod_sim)
```

```{r}
means_anova = tapply(dat$y, INDEX=dat$grp, FUN=mean)
means_anova
```

```{r}
plot(means_anova)
points("mu[1]", col="red") ## where means_theta are the posterior point estimates for the industry means.

```

```{r}

```

```{r}
#Final Project
library(readxl)
X1990_14WorldGHGLand <- read_excel("C:/Users/33219/Desktop/1990-14WorldGHGLand.xlsx")
View(X1990_14WorldGHGLand)
dat = na.omit(X1990_14WorldGHGLand)
dat$logergpc = log(dat$Ergpc)
dat$logGHG = log(dat$GHG)
dat$Country = as.numeric(factor(dat$Country))
head(dat)
```

```{r}
library("rjags")

mod_string = " model {
  for (i in 1:length(y)) {
    y[i] ~ dnorm(mu[i], prec)
    mu[i] = a[Country[i]] + b[1]*logergpc[i] + b[2]*Agland_rate[i]
  }
    for (j in 1:max(Country)) {
    a[j] ~ dnorm(a0, prec_a)
  }
  
  a0 ~ dnorm(0.0, 1.0/1.0e6)
  prec_a ~ dgamma(1/2.0, 1/2.0)
  tau = sqrt( 1.0 / prec_a )
  
  for (j in 1:2) {
    b[j] ~ dnorm(0.0, 1.0/1.0e6)
  }
  
  prec ~ dgamma(1/2.0, 1/2.0)
  sig = sqrt( 1.0 / prec )
} "

set.seed(116)
data_jags = list(y=dat$logGHG, logergpc=dat$logergpc,Agland_rate=dat$Agland,
                  Country=as.numeric(dat$Country))


params = c("a0", "a", "b", "sig", "tau")

mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1e4) # burn-in

mod_sim = coda.samples(model=mod,
                       variable.names=params,
                       n.iter=5e7)

mod_csim = as.mcmc(do.call(rbind, mod_sim)) # combine multiple chains

## convergence diagnostics
plot(mod_sim)

gelman.diag(mod_sim)
autocorr.diag(mod_sim)
autocorr.plot(mod_sim)
effectiveSize(mod_sim)

dic.samples(mod, n.iter=1e3)

summary(mod_sim)
```

